{# templates/note_edit.html #}
{% extends 'base.html' %}

{% block title %}
  {{ note and '編輯筆記' or '新增筆記' }} | 數學記事本
{% endblock %}

{% block head_extra %}
  <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet" />
  <style>
    /* 編輯區容器 */
    .note-detail-container {
      max-width: 900px;
      width: 90%;
      margin: 2rem auto;
    }
    /* 標題漸層 */
    .edit-heading {
      font-size: 1.75rem;
      background: linear-gradient(45deg, #9d50bb, #6e48aa);
      -webkit-background-clip: text;
      color: transparent;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }
    /* 編輯器本體 */
    #editor {
      min-height: 200px;
      max-height: 600px;
      resize: vertical;
      overflow: auto;
      background: #fffbe6;        /* 淡奶黃色，仿筆記本 */
      border: 2px solid indigo;  /* 靛藍外框 */
      border-radius: 0.5rem;
      padding: 1rem;
    }
  </style>
{% endblock %}

{% block content %}
<div class="note-detail-container">
  <div class="card shadow-sm">
    <div class="card-header bg-white">
      <h4 class="mb-0 edit-heading">
        {{ note and '編輯筆記' or '新增筆記' }}
      </h4>
    </div>
    <div class="card-body">
      <form method="post" onsubmit="syncEditor()">
        <div class="mb-3">
          <label class="form-label fw-bold">分類</label>
          <input
            type="text"
            name="category"
            class="form-control"
            placeholder="例如：微積分／線性代數"
            value="{{ note.category if note else '' }}"
            required
          />
        </div>
        <div class="mb-3">
          <label class="form-label fw-bold">標題</label>
          <input
            type="text"
            name="title"
            class="form-control"
            placeholder="請輸入筆記標題"
            value="{{ note.title if note else '' }}"
            required
          />
        </div>
        <div class="mb-4">
          <label class="form-label fw-bold">內容 </label>

          <!-- 工具列 -->
          <div id="toolbar"></div>

          <!-- 編輯器本體 -->
          <div id="editor">{{ note.content|safe if note }}</div>

          <!-- 隱藏欄位 傳回後端 -->
          <input type="hidden" name="content" id="hidden-content" />
        </div>

        <button class="btn btn-primary me-2" type="submit">儲存</button>
        <a href="{{ url_for('note_list') }}" class="btn btn-secondary">取消</a>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="https://cdn.quilljs.com/1.3.7/quill.js"></script>
  <script>
    // 只留下需要的功能按鈕：標題、粗體、斜體、底線、刪除線、顏色、背景、引用、程式區塊、列表、對齊、連結、圖片、清除格式
    var toolbarOptions = [
      [{ 'header': [1, 2, false] }],
      ['bold','italic','underline','strike'],
      [{ 'color': [] }, { 'background': [] }],
      ['blockquote','code-block'],
      [{ 'list': 'ordered'}, { 'list': 'bullet' }],
      [{ 'align': [] }],
      ['link','image'],
      ['clean']
    ];
    var quill = new Quill('#editor', {
      modules: { toolbar: toolbarOptions },
      theme: 'snow'
    });
    function syncEditor() {
      document.getElementById('hidden-content').value = quill.root.innerHTML;
    }
  </script>
{% endblock %}
